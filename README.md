# GraphGuard: Dynamic Identity Verification Agent üõ°Ô∏è

**A GenAI-driven security system that replaces static security questions with dynamic, context-aware challenges based on real-time transaction graphs.**
---
**Team: Dynamic Agents**
---

## üë• Team & Roles
| Name | Role | GitHub |
| :--- | :--- | :--- |
| **Prathyu Adari** | **Product Intelligence, Strategy & Insight Lead ** | (https://github.com/PrathyushaRagavAdari ) |
| *Krutarth Lad* | *Systems, Data Architecture, ML & Pipeline Lead* | *(https://github.com/ladkrutarth)* |

> **Contact:** pradfy@umsystem.edu

---

## üöÄ Problem & Solution
* **The Problem:** Traditional Knowledge-Based Authentication (KBA) relies on static secrets ("What is your mother's maiden name?") that are easily bought on the dark web.
* **The Solution:** **GraphGuard** utilizes a temporal Knowledge Graph of a user's recent spending history to generate one-time, dynamic security questions (e.g., *"You visited a coffee shop in Seattle last Tuesday. Was it Starbucks or Tully's?"*) that are impossible for hackers to guess.

## üèóÔ∏è High-Level Architecture
1.  **Data Layer:** **Snowflake** stores transaction logs (Source of Truth).
2.  **Privacy Layer:** Python middleware hashes PII (Account IDs) using SHA-256 before inference.
3.  **Intelligence Layer:** **LlamaIndex** builds a temporary Knowledge Graph to map relationships between Users, Merchants, and Locations.
4.  **Agentic Core:** **Mistral-7B / GPT-4o** reasons over the graph to generate "Hard" questions and plausible "Distractor" answers (stored in **FAISS/Pinecone**).
5.  **Audit Layer:** A separate **Multimodal RAG** agent verifies all questions against NIST 800-63B guidelines before they are shown to the user.

---

## üìÇ Repository Structure

This repository is organized into five core modules enabling reproducibility and governance.

### üìÑ `/proposal/`
* `GraphGuard_Capstone_Proposal.pdf` ‚Äî The approved project proposal and feasibility study.
* `literature_review.md` ‚Äî Summaries of key papers on GraphRAG and Zero-Trust Architecture.

### üíæ `/data/`
* `dataset_card.md` ‚Äî Documentation for the [Kaggle Credit Card Fraud Dataset](https://www.kaggle.com/datasets/kartik2112/fraud-detection).
* `pii_masking.py` ‚Äî **Critical:** The cryptographic salt and hashing logic to anonymize user IDs.
* `synthetic_graph_schema.json` ‚Äî The ontology defining Node types (Merchant, Category) and Edges (TRANSACTED_AT).
* *(Note: Raw transaction data is NOT stored here for security; only scripts to fetch/mock it.)*

### üß† `/src/` (or `/notebooks/`)
* `01_Data_Ingestion.ipynb` ‚Äî Snowflake connection and graph construction pipeline.
* `02_GraphRAG_Agent.ipynb` ‚Äî The core logic for distinctiveness scoring and question generation.
* `03_Compliance_Audit.ipynb` ‚Äî The Week 3 Multimodal RAG system for NIST verification.
* `app.py` ‚Äî The **Streamlit** frontend code for the user authentication demo.

### ‚öñÔ∏è `/evaluation/`
* `benchmarks/` ‚Äî Results from the Ablation Study (Text-only vs. GraphRAG).
* `metrics_report.md` ‚Äî Automated scoring of Latency (1.7s avg) and Faithfulness (0.80 Precision).
* `failure_modes.md` ‚Äî Documentation of known edge cases (e.g., "Cold Start" for new users) and mitigation strategies.

### üìö `/docs/`
* `architecture_diagram.png` ‚Äî Visual flow of the GenAI stack.
* `governance_rules.md` ‚Äî The "Refusal Protocol" for non-banking queries.
* `weekly_updates/` ‚Äî Sprint logs and milestone tracking.

---

## üîó Key References
* **Data Source:** [Kaggle - Credit Card Transactions](https://www.kaggle.com/datasets/kartik2112/fraud-detection)
* **Regulatory Standard:** [NIST SP 800-63B (Digital Identity Guidelines)](https://pages.nist.gov/800-63-3/sp800-63b.html)
* **Core Tech:** [LlamaIndex (GraphRAG)](https://www.llamaindex.ai/)


# Week 3 Sprint: Multimodal Compliance RAG for GraphGuard

## 1. Product Brief

**Feature Name:** GraphGuard Compliance Audit Assistant

**Objective:** To enable internal risk officers to verify that the dynamic security questions generated by GraphGuard comply with federal identity guidelines (NIST 800-63B) and banking regulations.

**Problem Solved:** GraphGuard generates infinite unique questions. We need an automated way to check if a generated question (e.g., *"Select your transaction from 3 weeks ago"*) aligns with legal authentication assurance levels (AAL).

---

## 2. System Architecture

We implemented a **Hybrid Multimodal RAG** system to handle both text-heavy regulations and visual flowcharts found in banking policy documents.

* **Ingestion Layer:**
* **PDF Parsing:** `PyMuPDFLoader` for high-speed text extraction.
* **Visual Parsing:** Simulated Vision-Language Model (VLM) captioning for capturing data in the "AAL Requirements" table.
* **Chunking:** Recursive Character Splitter (1000 tokens, 100 overlap).


* **Retrieval Layer (Hybrid):**
* **Dense Search:** `sentence-transformers/all-MiniLM-L6-v2` (Hugging Face) stored in FAISS. Captures semantic meaning.
* **Sparse Search:** BM25 (Rank-BM25). Captures specific regulatory keywords (e.g., "AAL3", "CSP").
* **Fusion:** `EnsembleRetriever` with a 60/40 weight favoring semantic search.


* **Generation Layer:**
* **LLM:** `Mistral-7B-Instruct` (via Hugging Face Endpoint).
* **Prompt Engineering:** Strict system prompt enforcing "I do not have enough evidence" for out-of-domain queries.



---

## 3. Data Inventory

| Source | Modality | Role in Product | Status |
| --- | --- | --- | --- |
| **NIST SP 800-63B** | Text (PDF) | The "Ground Truth" for digital identity guidelines. | ‚úÖ Ingested |
| **FCRA** | Text (PDF) | The Fair Credit Reporting ACT. | ‚úÖ Ingested |
| **PCI** | Text (PDF) | The Payment Card Industry Data Security Standard. | ‚úÖ Ingested |
| **AAL Requirements and Other Images** | Image/Chart | Critical lookup tables for authentication assurance levels. | ‚úÖ Ingested via OCR |

---

## 4. Evaluation & Results

We evaluated the system on 3 core tasks: **Visual QA**, **Text QA**, and **Refusal**.

### A. Performance Metrics (Automated)

Based on a test set of 3 regulatory queries against the Knowledge Base.

| Metric | Value | Description |
| --- | --- | --- |
| **Avg Latency** | **1.77s** | Fast enough for real-time audit workflows (Goal < 3s). |
| **Precision@5** | **0.80** | 80% of retrieved chunks were relevant to the query. |
| **Recall@5** | **1.00** | The system found the correct answer 100% of the time. |
| **Faithfulness** | **100%** | No hallucinations detected; answers matched ground truth keywords. |

### B. Ablation Study (Text-Only vs. Multimodal)

We compared a standard Text-RAG against our Multimodal implementation.

| Task | User Query | Text-Only Result | Hybrid Multimodal Result | Decision |
| --- | --- | --- | --- | --- |
| **1. Visual Data** | *"Requirements for AAL3?"* | **Fail.** (Could not read the table image). | **Pass.** (Correctly cited "Hardware-based authenticator"). | **Ship Multimodal** |
| **2. Keyword** | *"Define Credential CSP"* | **Pass.** | **Pass.** (BM25 aided specific term retrieval). | **Ship Hybrid** |
| **3. Safety** | *"How to bake a cake?"* | **Pass.** (Refused). | **Pass.** (Refused: "I do not have enough evidence"). | **Ship** |

---

## 5. Failure Analysis & Risk Strategy

* **Observed Failure:** In early testing, the specific chunk containing "AAL2 requirements" was ranked #6, missing the context window when `k=5`.
* **Organizational Risk:** If the Auditor receives an incomplete list of requirements, they might approve a non-compliant security question, risking regulatory fines.
* **Mitigation Strategy:**
1. **Algorithmic:** Increased retrieval `k` to 7 to broaden context capture.
2. **UX:** Added a "Source Citation" footer so the human auditor can click the link to the original NIST PDF page to verify the full context.



## 6. Deployment Plan ("If we shipped this")

To move this from Colab to Production:

1. **Vector DB:** Migrate from local FAISS to **Pinecone** for persistent storage.
2. **Model:** Upgrade from Mistral-7B to **Llama-3-70B** for better reasoning on complex "gray area" compliance questions.
3. **Interface:** Build a Streamlit dashboard where Compliance Officers can upload new policy PDFs without coding.

# Week 4 Hands-On: Capstone Product Integration & Deployment Readiness


| **Project Metadata** | **Details** |
| :--- | :--- |
| **Role** | Security Product Analyst |
| **Stakeholder** | Bank Compliance Auditor / Fraud Operations |
| **Focus** | GraphRAG, Identity Verification, Governance |

---

## üöÄ Project Overview
**GraphGuard** is a Generative AI security agent designed to replace static Knowledge-Based Authentication (KBA) with **dynamic, context-aware challenges**.

By leveraging **GraphRAG** (LlamaIndex + Snowflake) and **GPT-4o**, the system constructs temporary knowledge graphs from a user's recent transaction history. [cite_start]This allows it to generate "hallucination-free" verification questions (e.g., *"You visited a coffee shop in Seattle last Tuesday. Was it Starbucks or Tully's?"*) that are intuitive for the owner but impossible for attackers to guess using stolen static data[cite: 10, 41, 107].

---

## üîó Deployment
### **Live Demo**
- **Streamlit App:** [(https://ldpvyhhvhvmlsypvgok9at.streamlit.app/)]
*(Note: If not yet deployed to cloud, please run locally using the instructions below)*

### **Run Locally**
1. **Clone the Repo:**
   ```bash
   git clone [https://github.com/PrathyushaRagavAdari/Dynamic-Auth-Agent.git](https://github.com/PrathyushaRagavAdari/Dynamic-Auth-Agent.git)
   cd Dynamic-Auth-Agent

## üèóÔ∏è Architecture   

The system follows a Retrieval-Augmented Generation (RAG) pattern with strict governance guardrails.

code snippet:

graph TD
    User[Compliance Officer] -->|1. Submit Query| UI[Streamlit App]
    UI -->|2. Hash PII| Middleware[Python Middleware]
    Middleware -->|3. Retrieve Context| RAG[RAG Engine]
    RAG -->|4. Fetch Chunks| DB[(NIST PDF / FAISS)]
    RAG -->|5. Generate Verdict| LLM[GPT-4o]
    LLM -->|6. Return Response| UI
    UI -->|7. Log Interaction| Logs[(product_metrics.csv)]
    UI -->|8. Update Metrics| Sidebar[Metrics Dashboard]
